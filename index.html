<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Know Your Area</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
        :root {
            --primary: #2c7a5a;
            --primary-dark: #1e5e44;
            --secondary: #3498db;
            --light: #f8f9fa;
            --dark: #343a40;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f4f4f4;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 10px 10px;
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .quick-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .visitor-counter {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .search-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .search-container {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
            gap: 10px;
        }
        
        .search-container input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-container input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 122, 90, 0.2);
        }
        
        .search-container button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-container button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .search-container button.reset {
            background-color: var(--gray);
        }
        
        .search-container button.reset:hover {
            background-color: var(--dark);
        }

        .search-container:has(input:disabled) {
            opacity: 0.7;
            pointer-events: none;
        }

        .search-container:has(input:disabled)::after {
            content: "Loading data...";
            display: block;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .results-container {
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .results-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .results-header h2 {
            font-size: 1.4rem;
        }
        
        .ward-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            background: var(--light-gray);
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .info-card {
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
        }
        
        .info-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-card p {
            margin-bottom: 5px;
        }
        
        .contact-link {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            color: var(--secondary);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .contact-link:hover {
            color: var(--primary);
        }

        .contact-disabled {
            color: var(--gray);
            cursor: not-allowed;
        }

        .security-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .security-warning i {
            color: var(--warning);
            margin-right: 10px;
        }
        
        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .emergency-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--danger);
            transition: transform 0.3s;
        }
        
        .emergency-card:hover {
            transform: translateY(-5px);
        }
        
        .emergency-card i {
            font-size: 2rem;
            color: var(--danger);
            margin-bottom: 10px;
        }
        
        .emergency-card h3 {
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .emergency-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--danger);
            margin: 10px 0;
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
        }
        
        .action-btn {
            flex: 1;
            min-width: 150px;
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .action-btn i {
            font-size: 1.8rem;
            color: var(--primary);
        }
        
        .action-btn span {
            font-weight: 600;
            color: var(--dark);
        }
        
        .disclaimer {
            text-align: center;
            font-size: 0.85rem;
            color: var(--gray);
            background-color: var(--light-gray);
            padding: 15px;
            margin-top: 30px;
            border-radius: 8px;
            line-height: 1.5;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            display: none;
            background: #ffeaea;
            color: var(--danger);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid var(--danger);
        }
        
        .suggestions {
            display: none;
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .suggestion-item:hover {
            background-color: var(--light);
        }

        .data-status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .data-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .data-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Public Interest Banner */
        .public-interest-banner {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 4px solid var(--secondary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }

        .public-interest-banner i {
            color: var(--secondary);
            margin-right: 10px;
        }

        /* Analytics Dashboard Styles - SMALLER SIZE */
        .analytics-dashboard {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .analytics-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
        }

        .analytics-card.mobile {
            border-left: 3px solid var(--primary);
        }

        .analytics-card.desktop {
            border-left: 3px solid var(--secondary);
        }

        .analytics-card.tablet {
            border-left: 3px solid var(--success);
        }

        .analytics-card.total {
            border-left: 3px solid var(--warning);
        }

        .analytics-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .analytics-count {
            font-weight: bold;
            font-size: 1.5rem;
            margin: 8px 0;
        }

        .analytics-label {
            color: var(--gray);
            font-size: 0.8rem;
        }

        /* IP Address Display */
        .ip-info {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-size: 0.85rem;
            color: var(--gray);
            border: 1px solid var(--light-gray);
        }

        .ip-address {
            font-family: monospace;
            background: white;
            padding: 8px 12px;
            border-radius: 5px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid var(--light-gray);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .terms-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: var(--light);
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid var(--light-gray);
        }

        .terms-checkbox {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: var(--gray);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* CAPTCHA Styles */
        .captcha-container {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }

        .captcha-message {
            color: var(--danger);
            font-weight: 600;
            margin-bottom: 15px;
        }

        .rate-limit-message {
            background: #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            color: #856404;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .info-grid, .emergency-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-info {
                flex-direction: column;
                gap: 10px;
            }

            .modal-content {
                padding: 20px;
            }

            .modal-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-card {
                padding: 12px;
            }
            
            .analytics-icon {
                font-size: 1.5rem;
            }
            
            .analytics-count {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Terms Acceptance Modal -->
    <div class="modal" id="termsModal">
        <div class="modal-content">
            <h3><i class="fas fa-shield-alt"></i> Terms of Use Agreement</h3>
            <div class="terms-content">
                <p><strong>Important Notice Regarding Contact Information</strong></p>
                <p>By accessing contact information of public representatives, you agree to the following terms:</p>
                
                <p><strong>1. Permitted Use:</strong></p>
                <ul>
                    <li>Official civic communication only</li>
                    <li>Reporting local issues and concerns</li>
                    <li>Seeking assistance with government services</li>
                </ul>

                <p><strong>2. Prohibited Activities:</strong></p>
                <ul>
                    <li>Harassment, threats, or abusive communication</li>
                    <li>Commercial marketing or spam</li>
                    <li>Political campaigning without consent</li>
                    <li>Any illegal activities</li>
                </ul>

                <p><strong>3. Security Measures:</strong></p>
                <ul>
                    <li>Contact clicks are rate-limited and monitored</li>
                    <li>IP addresses are logged for security</li>
                    <li>CAPTCHA verification required for multiple accesses</li>
                    <li>Misuse may result in permanent ban</li>
                </ul>

                <p><strong>4. Legal Consequences:</strong></p>
                <p>Violation of these terms may result in:</p>
                <ul>
                    <li>Legal action under Indian IT Act, 2000</li>
                    <li>Criminal prosecution under relevant laws</li>
                    <li>Civil liability for damages</li>
                </ul>

                <p style="margin-top: 20px; color: var(--danger);">
                    <strong>‚ö†Ô∏è Warning:</strong> This system monitors and logs all access to contact information. 
                    Misuse will be reported to appropriate authorities.
                </p>
            </div>
            <div class="terms-checkbox">
                <input type="checkbox" id="acceptTerms">
                <label for="acceptTerms">I have read and agree to the Terms of Use</label>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="acceptTerms()">Accept & Continue</button>
                <button class="modal-btn secondary" onclick="declineTerms()">Decline</button>
            </div>
        </div>
    </div>

    <!-- CAPTCHA Modal -->
    <div class="modal" id="captchaModal">
        <div class="modal-content">
            <h3><i class="fas fa-robot"></i> Security Verification</h3>
            <div class="captcha-container">
                <p class="captcha-message">Multiple contact access detected. Please verify you're human.</p>
                <div class="g-recaptcha" data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"></div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
                    This helps prevent automated misuse of contact information.
                </p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="verifyCaptcha()">Verify</button>
                <button class="modal-btn secondary" onclick="closeCaptcha()">Cancel</button>
            </div>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-map-marked-alt"></i>
                    <div class="logo-text">
                        <h1>Know Your Area</h1>
                        <p>Access local information and services</p>
                    </div>
                </div>
                <div class="quick-info">
                    <p><i class="fas fa-info-circle"></i> Find your ward representatives and essential services</p>
                    <div class="visitor-counter">
                        <i class="fas fa-users"></i> 
                        <span id="simpleVisitorCount">0</span> Visitors
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Public Interest Banner -->
        <div class="public-interest-banner">
            <i class="fas fa-handshake"></i>
            <strong>Public Service Initiative:</strong> This service is provided in public interest to help citizens access local government information easily.
        </div>

        <section class="search-section">
            <h2>Find Information for Your Ward</h2>
            <div class="data-status" id="data-status">
                <i class="fas fa-sync-alt fa-spin"></i> Loading ward data from GitHub...
            </div>
            <div class="search-container">
                <input type="text" id="ward" placeholder="Enter Ward Number (e.g., 1, 2, 3...)" autocomplete="off" disabled>
                <button onclick="fetchWardData()" id="search-btn" disabled>
                    <i class="fas fa-search"></i> Get Details
                </button>
                <button onclick="resetSearch()" class="reset" id="reset-btn" disabled>
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
            <div class="suggestions" id="suggestions"></div>
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Fetching ward information...</p>
            </div>
            <div class="error-message" id="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="error-text">No data found for this Ward Number. Please try again.</span>
            </div>
        </section>
        
        <section class="results-container" id="results-container">
            <div class="results-header">
                <h2>Ward Information</h2>
                <div class="ward-badge">Ward: <span id="wardNo">N/A</span></div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="administrative">Administrative</div>
                <div class="tab" data-tab="representatives">Representatives</div>
                <div class="tab" data-tab="emergency">Emergency Services</div>
                <div class="tab" data-tab="utilities">Utilities</div>
            </div>
            
            <div class="tab-content active" id="administrative">
                <div class="info-grid">
                    <div class="info-card">
                        <h3><i class="fas fa-landmark"></i> Basic Information</h3>
                        <p><strong>Ward Name:</strong> <span id="wardName">N/A</span></p>
                        <p><strong>Circle No:</strong> <span id="circleNo">N/A</span></p>
                        <p><strong>Zone:</strong> <span id="zone">N/A</span></p>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Location Details</h3>
                        <p><strong>Pincode:</strong> <span id="pincode">N/A</span></p>
                        <p><strong>Mandal:</strong> <span id="mandalName">N/A</span></p>
                        <p><strong>District:</strong> <span id="districtName">N/A</span></p>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-vote-yea"></i> Political Constituencies</h3>
                        <p><strong>Assembly Constituency:</strong> <span id="assemblyName">N/A</span></p>
                        <p><strong>Parliamentary Constituency:</strong> <span id="parliament">N/A</span></p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="representatives">
                <div class="security-warning">
                    <i class="fas fa-shield-alt"></i>
                    <strong>Security Notice:</strong> Contact information is provided for official purposes only. 
                    Misuse of this information for harassment, spam, or illegal activities is strictly prohibited 
                    and may result in legal action under Indian IT Act.
                </div>
                
                <div id="rateLimitMessage" class="rate-limit-message" style="display: none;">
                    <i class="fas fa-hourglass-half"></i>
                    Contact access rate limit reached. Please try again later.
                </div>
                
                <div class="info-grid">
                    <div class="info-card">
                        <h3><i class="fas fa-user-tie"></i> MLA Details</h3>
                        <p><strong>Name:</strong> <span id="NameoftheMLA">N/A</span></p>
                        <p><strong>Address:</strong> <span id="AddressofCandidate">N/A</span></p>
                        <div id="mlaContactContainer">
                            <!-- MLA contact will be dynamically added here -->
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-user"></i> Corporator Details</h3>
                        <p><strong>Name:</strong> <span id="NameoftheCorporator">N/A</span></p>
                        <div id="corporatorContacts">
                            <!-- Contact numbers will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Debug Information -->
                    <div class="info-card">
                        <h3><i class="fas fa-bug"></i> Debug Information</h3>
                        <p><strong>Available Fields:</strong></p>
                        <div class="debug-info" id="debugFields"></div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="emergency">
                <div class="emergency-grid">
                    <div class="emergency-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Police Station</h3>
                        <div class="emergency-number">
                            <a href="tel:100">100</a>
                        </div>
                        <a href="https://www.cyberabadpolice.gov.in/know-your-police-station/know-your-ps.html#" target="_blank">Find Your Police Station</a>
                    </div>
                    
                    <div class="emergency-card">
                        <i class="fas fa-fire-extinguisher"></i>
                        <h3>Fire Services</h3>
                        <div class="emergency-number">
                            <a href="tel:101">101</a>
                        </div>
                    </div>
                    
                    <div class="emergency-card">
                        <i class="fas fa-ambulance"></i>
                        <h3>Ambulance</h3>
                        <div class="emergency-number">
                            <a href="tel:102">102</a>, <a href="tel:108">108</a>
                        </div>
                    </div>
                    
                    <div class="emergency-card">
                        <i class="fas fa-female"></i>
                        <h3>Women Helpline</h3>
                        <div class="emergency-number">
                            <a href="tel:181">181</a>
                        </div>
                    </div>
                    
                    <div class="emergency-card">
                        <i class="fas fa-child"></i>
                        <h3>Child Helpline</h3>
                        <div class="emergency-number">
                            <a href="tel:1098">1098</a>
                        </div>
                    </div>
                    
                    <div class="emergency-card">
                        <i class="fas fa-tint"></i>
                        <h3>Blood Bank</h3>
                        <div class="emergency-number">
                            <a href="tel:040-24745243">040-24745243</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="utilities">
                <div class="info-grid">
                    <div class="info-card">
                        <h3><i class="fas fa-tint"></i> Water Supply & Sewerage</h3>
                        <p><strong>Customer Care:</strong> <a href="tel:155313">155313</a></p>
                        <p><strong>EPABX Lines:</strong> <a href="tel:04023433933">040-23433933</a></p>
                        <p><strong>Fax (MD's Office):</strong> <a href="tel:04023442855">040-23442855</a></p>
                        <a href="https://hyderabadwater.gov.in/en/index.php/services/customers-services/know-your-area-offices" target="_blank" class="contact-link">
                            <i class="fas fa-external-link-alt"></i> Know Your Area Officer
                        </a>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-bolt"></i> Electricity Services</h3>
                        <p><strong>Complaint:</strong> <a href="tel:1912">1912</a></p>
                        <a href="https://tgsouthernpower.org/controlroom" target="_blank" class="contact-link">
                            <i class="fas fa-external-link-alt"></i> Control Room Numbers
                        </a>
                        <a href="https://www.tgsouthernpower.org/fuseoffcallcenters" target="_blank" class="contact-link">
                            <i class="fas fa-external-link-alt"></i> FOC Contact Numbers
                        </a>
                        <a href="https://tgsouthernpower.org/Contacts/teldir/td.html" target="_blank" class="contact-link">
                            <i class="fas fa-external-link-alt"></i> Section Office Contacts
                        </a>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-paw"></i> Animal Services</h3>
                        <p><strong>GHMC Street Dog Complaint:</strong></p>
                        <p><a href="tel:040-21111111">040-21111111</a>, <a href="tel:040-23225397">040-23225397</a></p>
                    </div>
                </div>
            </div>
        </section>
        
        <div class="quick-actions">
            <div class="action-btn" onclick="scrollToSection('emergency')">
                <i class="fas fa-phone-alt"></i>
                <span>Emergency Contacts</span>
            </div>
            <div class="action-btn" onclick="scrollToSection('utilities')">
                <i class="fas fa-tools"></i>
                <span>Utility Services</span>
            </div>
            <div class="action-btn" onclick="scrollToSection('representatives')">
                <i class="fas fa-users"></i>
                <span>Public Representatives</span>
            </div>
        </div>

        <!-- Analytics Dashboard - Smaller and moved above disclaimer -->
        <section class="analytics-dashboard" id="analyticsDashboard">
            <h3><i class="fas fa-chart-bar"></i> Visitor Statistics</h3>
            <p style="color: var(--gray); margin-bottom: 15px; font-size: 0.9rem;">Real-time visitor analytics</p>
            
            <div class="analytics-grid">
                <div class="analytics-card mobile">
                    <div class="analytics-icon">üì±</div>
                    <div class="analytics-count" id="mobileVisitors">0</div>
                    <div class="analytics-label">Mobile</div>
                </div>
                
                <div class="analytics-card desktop">
                    <div class="analytics-icon">üíª</div>
                    <div class="analytics-count" id="desktopVisitors">0</div>
                    <div class="analytics-label">Desktop</div>
                </div>
                
                <div class="analytics-card tablet">
                    <div class="analytics-icon">üìä</div>
                    <div class="analytics-count" id="tabletVisitors">0</div>
                    <div class="analytics-label">Tablet</div>
                </div>
                
                <div class="analytics-card total">
                    <div class="analytics-icon">üë•</div>
                    <div class="analytics-count" id="totalVisitors">0</div>
                    <div class="analytics-label">Total</div>
                </div>
            </div>
        </section>

        <!-- IP Address Display -->
        <div class="ip-info">
            <p><i class="fas fa-network-wired"></i> Your Connection Information</p>
            <div class="ip-address" id="ipAddress">Loading IP address...</div>
            <p style="font-size: 0.75rem; margin-top: 8px;">
                <i class="fas fa-info-circle"></i> For security monitoring purposes
            </p>
        </div>
        
        <div class="disclaimer">
            <p><strong>Non-Affiliation Disclaimer:</strong> This is an independent citizen initiative and is not affiliated with GHMC or any government department. All information provided on this website is sourced from official government websites including GHMC, HMWS&SB, TSSPDCL, and Cyberabad Police.</p>
            
            <p style="margin-top: 10px;"><strong>Public Interest Statement:</strong> This service is provided in public interest to help citizens access local government information easily. Contact information is published from official sources for civic engagement purposes.</p>
            
            <p style="margin-top: 10px;"><strong>Content Removal:</strong> We will promptly remove any information if officially requested by competent authorities or if found to be inaccurate.</p>
            
            <p style="margin-top: 10px; color: var(--danger);">
                <strong>Security Notice:</strong> Contact information is provided for official civic purposes only. 
                Misuse for harassment, spam, or illegal activities is prohibited and may lead to legal action under Indian IT Act, 2000.
            </p>
        </div>
    </div>

    <script>
        let csvData = [];
        let dataLoaded = false;
        let termsAccepted = false;
        let contactClicksThisSession = 0;
        let captchaVerified = false;
        let userIP = '';

        // Security Configuration
        const SECURITY_CONFIG = {
            maxContactClicksPerSession: 5,
            sessionDuration: 24 * 60 * 60 * 1000, // 24 hours
            requireCaptchaAfter: 3,
            ipTracking: true
        };

        // GitHub Raw CSV URL - No CORS issues!
        const GITHUB_CSV_URL = "https://raw.githubusercontent.com/gisintelugu/knowyourarea/refs/heads/main/knowyourarea.csv";

        // Visitor Analytics System
        let analyticsData = {
            mobile: 0,
            desktop: 0,
            tablet: 0,
            total: 0,
            contactClicks: 0,
            ipAddresses: [],
            securityEvents: []
        };

        // Load analytics from localStorage
        function loadAnalytics() {
            const saved = localStorage.getItem('knowYourAreaAnalytics');
            if (saved) {
                analyticsData = JSON.parse(saved);
            }
            updateAnalyticsDisplay();
        }

        // Save analytics to localStorage
        function saveAnalytics() {
            localStorage.setItem('knowYourAreaAnalytics', JSON.stringify(analyticsData));
        }

        // Track IP Address
        function trackIPAddress() {
            if (!SECURITY_CONFIG.ipTracking) return;
            
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    userIP = data.ip;
                    document.getElementById('ipAddress').textContent = `IP: ${userIP}`;
                    
                    if (!analyticsData.ipAddresses.includes(userIP)) {
                        analyticsData.ipAddresses.push(userIP);
                        saveAnalytics();
                    }
                    console.log('IP Address tracked:', userIP);
                })
                .catch(error => {
                    console.log('IP tracking failed:', error);
                    document.getElementById('ipAddress').textContent = 'IP: Not available';
                });
        }

        // Get MAC address (limited browser capability)
        function getMacAddress() {
            // Note: Browsers don't allow direct MAC address access for security reasons
            // This is a placeholder to show the concept
            return 'MAC: Browser restricted';
        }

        // Log security event
        function logSecurityEvent(event, details) {
            analyticsData.securityEvents.push({
                timestamp: new Date().toISOString(),
                event: event,
                details: details,
                contactClicks: contactClicksThisSession,
                ip: userIP
            });
            saveAnalytics();
            console.log('Security Event:', event, details);
        }

        // Detect device type and track visitor
        function trackVisitor() {
            const deviceType = getDeviceType();
            analyticsData[deviceType]++;
            analyticsData.total++;
            
            saveAnalytics();
            updateAnalyticsDisplay();
            trackIPAddress();
            
            console.log('Visitor tracked - Device:', deviceType, 'Total:', analyticsData.total);
        }

        // Check if user can access contacts
        function canAccessContacts() {
            if (!termsAccepted) {
                showTermsModal();
                return false;
            }

            if (contactClicksThisSession >= SECURITY_CONFIG.maxContactClicksPerSession) {
                showRateLimitMessage();
                return false;
            }

            if (contactClicksThisSession >= SECURITY_CONFIG.requireCaptchaAfter && !captchaVerified) {
                showCaptchaModal();
                return false;
            }

            return true;
        }

        // Track contact clicks for security monitoring
        function trackContactClick(type) {
            if (!canAccessContacts()) {
                return false;
            }

            contactClicksThisSession++;
            analyticsData.contactClicks++;
            
            logSecurityEvent('CONTACT_CLICK', {
                type: type,
                sessionClicks: contactClicksThisSession,
                totalClicks: analyticsData.contactClicks
            });
            
            saveAnalytics();
            console.log(`Contact click tracked - Type: ${type}, Session: ${contactClicksThisSession}, Total: ${analyticsData.contactClicks}`);
            
            // Show security reminder on first contact click
            if (contactClicksThisSession === 1) {
                setTimeout(() => {
                    alert('üîí Remember: Contact information is for official purposes only. Misuse may lead to legal consequences.');
                }, 1000);
            }

            return true;
        }

        // Show rate limit message
        function showRateLimitMessage() {
            document.getElementById('rateLimitMessage').style.display = 'block';
            logSecurityEvent('RATE_LIMIT_HIT', {
                sessionClicks: contactClicksThisSession
            });
        }

        // Show terms modal
        function showTermsModal() {
            document.getElementById('termsModal').style.display = 'flex';
        }

        // Accept terms
        function acceptTerms() {
            if (!document.getElementById('acceptTerms').checked) {
                alert('Please accept the Terms of Use to continue.');
                return;
            }
            
            termsAccepted = true;
            document.getElementById('termsModal').style.display = 'none';
            localStorage.setItem('knowYourAreaTermsAccepted', 'true');
            logSecurityEvent('TERMS_ACCEPTED', {});
        }

        // Decline terms
        function declineTerms() {
            document.getElementById('termsModal').style.display = 'none';
            alert('You must accept the Terms of Use to access contact information.');
            logSecurityEvent('TERMS_DECLINED', {});
        }

        // Show CAPTCHA modal
        function showCaptchaModal() {
            document.getElementById('captchaModal').style.display = 'flex';
        }

        // Verify CAPTCHA
        function verifyCaptcha() {
            // In a real implementation, you would verify with your server
            // For demo purposes, we'll simulate successful verification
            captchaVerified = true;
            document.getElementById('captchaModal').style.display = 'none';
            logSecurityEvent('CAPTCHA_VERIFIED', {});
            
            // Refresh the contact display
            const currentWard = document.getElementById('ward').value;
            if (currentWard) {
                fetchWardData();
            }
        }

        // Close CAPTCHA modal
        function closeCaptcha() {
            document.getElementById('captchaModal').style.display = 'none';
        }

        // Enhanced device detection
        function getDeviceType() {
            const userAgent = navigator.userAgent.toLowerCase();
            const screenWidth = window.screen.width;
            
            // Mobile detection
            if (/android|webos|iphone|ipod|blackberry|iemobile|opera mini/i.test(userAgent)) {
                if (screenWidth < 768) {
                    return 'mobile';
                }
                return 'tablet';
            }
            
            // Tablet detection
            if (/ipad|tablet|playbook|silk/i.test(userAgent) || (screenWidth <= 1024 && screenWidth >= 768)) {
                return 'tablet';
            }
            
            // Desktop
            return 'desktop';
        }

        // Update analytics display
        function updateAnalyticsDisplay() {
            document.getElementById('mobileVisitors').textContent = analyticsData.mobile;
            document.getElementById('desktopVisitors').textContent = analyticsData.desktop;
            document.getElementById('tabletVisitors').textContent = analyticsData.tablet;
            document.getElementById('totalVisitors').textContent = analyticsData.total;
            document.getElementById('simpleVisitorCount').textContent = analyticsData.total;
        }

        // Reset search function
        function resetSearch() {
            document.getElementById('ward').value = '';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('suggestions').style.display = 'none';
            document.getElementById('rateLimitMessage').style.display = 'none';
            
            // Reset all fields to N/A
            document.querySelectorAll('[id]').forEach(element => {
                if (element.id !== 'ward' && element.id !== 'simpleVisitorCount' && element.id !== 'ipAddress') {
                    if (element.tagName === 'SPAN') {
                        element.textContent = 'N/A';
                    }
                }
            });
            
            // Clear contact containers
            document.getElementById('mlaContactContainer').innerHTML = '';
            document.getElementById('corporatorContacts').innerHTML = '';
            
            console.log('Search reset successfully');
        }

        // Load data from GitHub with caching
        function loadDataWithCache() {
            const CACHE_KEY = 'knowYourAreaData';
            const CACHE_DURATION = 30 * 60 * 1000; // 30 minutes
            
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached) {
                const { data, timestamp } = JSON.parse(cached);
                if (Date.now() - timestamp < CACHE_DURATION) {
                    console.log("Using cached data");
                    processCSVData(data);
                    return;
                }
            }
            
            // Load fresh data
            console.log("Loading fresh data from GitHub:", GITHUB_CSV_URL);
            
            document.getElementById('data-status').innerHTML = 
                '<i class="fas fa-sync-alt fa-spin"></i> Loading ward data from GitHub...';
            
            fetch(GITHUB_CSV_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    console.log("Raw data received from GitHub, length:", text.length);
                    
                    if (!text || text.trim().length === 0) {
                        throw new Error('Empty response from GitHub');
                    }
                    
                    // Cache the data
                    localStorage.setItem(CACHE_KEY, JSON.stringify({
                        data: text,
                        timestamp: Date.now()
                    }));
                    
                    processCSVData(text);
                })
                .catch(error => {
                    console.error("Error loading fresh data:", error);
                    // Try to use cached data even if expired
                    if (cached) {
                        const { data } = JSON.parse(cached);
                        processCSVData(data);
                        document.getElementById('data-status').innerHTML = 
                            '<i class="fas fa-exclamation-triangle"></i> Using cached data (unable to fetch latest)';
                    } else {
                        document.getElementById('data-status').innerHTML = 
                            `<i class="fas fa-exclamation-triangle"></i> Error: ${error.message}`;
                        document.getElementById('data-status').className = 'data-status error';
                    }
                });
        }

        function processCSVData(text) {
            console.log("Processing CSV data...");
            
            // Parse CSV data
            const rows = parseCSV(text);
            console.log("Parsed rows:", rows.length);
            
            if (rows.length < 2) {
                throw new Error('No data rows found in CSV');
            }
            
            const headers = normalizeHeaders(rows[0]);
            console.log("Normalized CSV Headers:", headers);
            
            // Create data objects
            csvData = rows.slice(1)
                .filter(row => row.length > 0 && row[0].trim() !== '') // Remove empty rows
                .map(row => {
                    let obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = row[index] ? row[index].trim() : '';
                    });
                    return obj;
                });

            console.log("Successfully loaded data from GitHub:", csvData.length, "records");
            
            if (csvData.length > 0) {
                console.log("First record:", csvData[0]);
                console.log("Available ward numbers:", csvData.map(row => row["wardno"] || "N/A"));
            }
            
            // Enable search and show success
            dataLoaded = true;
            document.getElementById('data-status').innerHTML = 
                '<i class="fas fa-check-circle"></i> Data loaded successfully from GitHub! ' + 
                csvData.length + ' wards available. Try searching for ward numbers.';
            document.getElementById('data-status').className = 'data-status success';
            
            document.getElementById('ward').disabled = false;
            document.getElementById('search-btn').disabled = false;
            document.getElementById('reset-btn').disabled = false;
            
            // Show sample ward numbers for user guidance
            const sampleWards = getSampleWardNumbers();
            if (sampleWards) {
                document.getElementById('ward').placeholder = "Enter Ward Number (e.g., " + sampleWards + ")";
            }
        }

        // Better CSV Header Normalization
        function normalizeHeaders(headers) {
            return headers.map(header => {
                const normalized = header.trim()
                    .toLowerCase()
                    .replace(/[^a-z0-9]/g, '')
                    .replace(/\s+/g, '');
                
                // Map common variations to standard names
                const headerMap = {
                    'wardno': 'wardno',
                    'wardnumber': 'wardno',
                    'ward': 'wardno',
                    'wardname': 'wardname',
                    'circleno': 'circleno',
                    'circle': 'circleno',
                    'zone': 'zone',
                    'nameofthemla': 'mlaname',
                    'mlaname': 'mlaname',
                    'mla': 'mlaname',
                    'nameofthecorporator': 'corporatorname',
                    'corporatorname': 'corporatorname',
                    'corporator': 'corporatorname',
                    'mlacontactno': 'mlacontact',
                    'mlacontact': 'mlacontact',
                    'contactnumber1': 'contact1',
                    'contactnumber2': 'contact2',
                    'contact': 'contact1',
                    'addressofcandidate': 'mlaaddress',
                    'pincode': 'pincode',
                    'mandalname': 'mandal',
                    'districtname': 'district',
                    'assemblyname': 'assembly',
                    'parliament': 'parliament'
                };
                
                return headerMap[normalized] || normalized;
            });
        }

        function getSampleWardNumbers() {
            if (csvData.length === 0) return null;
            const sampleWards = csvData.slice(0, 3).map(row => 
                row["wardno"] || "N/A"
            ).filter(ward => ward !== "N/A");
            return sampleWards.length > 0 ? sampleWards.join(", ") : null;
        }

        // Improved CSV parser
        function parseCSV(text) {
            const rows = [];
            const lines = text.split('\n');
            
            for (let line of lines) {
                // Skip empty lines
                if (!line.trim()) continue;
                
                // Handle quoted fields and commas within quotes
                const row = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        row.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                // Add the last field
                row.push(current.trim());
                rows.push(row);
            }
            
            return rows;
        }

        // Enhanced Search Functionality
        function enhancedSearch(wardInput) {
            const input = wardInput.toLowerCase().trim();
            
            // Try exact match first
            let result = csvData.find(row => {
                const wardNo = (row.wardno || '').toString().toLowerCase();
                return wardNo === input;
            });
            
            // Try partial match
            if (!result) {
                result = csvData.find(row => {
                    const wardNo = (row.wardno || '').toString().toLowerCase();
                    return wardNo.includes(input) || input.includes(wardNo);
                });
            }
            
            // Try numeric match (remove leading zeros)
            if (!result) {
                const numericInput = input.replace(/^0+/, '');
                result = csvData.find(row => {
                    const wardNo = (row.wardno || '').toString().replace(/^0+/, '');
                    return wardNo === numericInput;
                });
            }
            
            return result;
        }

        function fetchWardData() {
            if (!dataLoaded) {
                showError("Data is still loading. Please wait a moment.", true);
                return;
            }

            let wardInput = document.getElementById("ward").value.trim();
            if (!wardInput) {
                showError("Please enter a Ward Number.", true);
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('suggestions').style.display = 'none';
            document.getElementById('rateLimitMessage').style.display = 'none';
            
            // Use enhanced search
            let result = enhancedSearch(wardInput);

            if (result) {
                console.log("Found ward data:", result);
                populateWardData(result);
            } else {
                // If exact match not found, show available wards
                const availableWards = csvData.map(row => 
                    row["wardno"] || "N/A"
                ).filter(ward => ward !== "N/A");
                
                showError("No data found for Ward: '" + wardInput + "'. Available wards: " + availableWards.join(", "), true);
                document.getElementById('loading').style.display = 'none';
            }
        }

        function populateWardData(result) {
            console.log("Populating data for ward:", result);
            
            // Validate data
            if (!validateWardData(result)) {
                showError("Incomplete data for this ward. Some information may be missing.", true);
            }
            
            // Show debug information
            showDebugInfo(result);
            
            // Helper function to get value from multiple possible column names
            function getValue(possibleKeys) {
                for (let key of possibleKeys) {
                    if (result[key] && result[key].trim() !== "") {
                        return result[key];
                    }
                }
                return "N/A";
            }

            // Administrative Details
            document.getElementById("wardNo").innerText = getValue(["wardno"]);
            document.getElementById("wardName").innerText = getValue(["wardname"]);
            document.getElementById("circleNo").innerText = getValue(["circleno"]);
            document.getElementById("zone").innerText = getValue(["zone"]);
            document.getElementById("pincode").innerText = getValue(["pincode"]);
            document.getElementById("mandalName").innerText = getValue(["mandal"]);
            document.getElementById("districtName").innerText = getValue(["district"]);
            document.getElementById("assemblyName").innerText = getValue(["assembly"]);
            document.getElementById("parliament").innerText = getValue(["parliament"]);

            // MLA Details
            document.getElementById("NameoftheMLA").innerText = getValue(["mlaname"]);
            document.getElementById("AddressofCandidate").innerText = getValue(["mlaaddress"]);

            // Corporator Details
            document.getElementById("NameoftheCorporator").innerText = getValue(["corporatorname"]);

            // Contact Numbers - SHOW FULL NUMBERS DIRECTLY
            setupMLAContact(
                getValue(["mlacontact"])
            );
            
            // Corporator Contacts - SHOW FULL NUMBERS DIRECTLY
            setupCorporatorContacts(result);
            
            // Show results
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            
            // Scroll to results
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
        }

        // Data Validation
        function validateWardData(data) {
            const requiredFields = ['wardno', 'wardname'];
            const missingFields = requiredFields.filter(field => !data[field] || data[field] === 'N/A');
            
            if (missingFields.length > 0) {
                console.warn('Missing required fields:', missingFields);
                return false;
            }
            return true;
        }

        function showDebugInfo(result) {
            const debugFields = document.getElementById('debugFields');
            let debugHTML = '';
            
            // Show all fields and their values
            for (const [key, value] of Object.entries(result)) {
                debugHTML += `<div><strong>${key}:</strong> "${value}"</div>`;
            }
            
            debugFields.innerHTML = debugHTML;
        }

        function setupMLAContact(contact) {
            const container = document.getElementById('mlaContactContainer');
            container.innerHTML = '';
            
            if (contact && contact !== "N/A" && contact.trim() !== "") {
                const contactLink = document.createElement('a');
                contactLink.href = `https://wa.me/${formatContactNumber(contact)}`;
                contactLink.className = 'contact-link';
                contactLink.target = '_blank';
                contactLink.innerHTML = `<i class="fab fa-whatsapp"></i> <span>${contact}</span>`;
                contactLink.onclick = function() { 
                    return trackContactClick('MLA'); 
                };
                container.appendChild(contactLink);
            } else {
                const noContact = document.createElement('div');
                noContact.className = 'contact-link';
                noContact.innerHTML = `<i class="fab fa-whatsapp"></i> <span>N/A</span>`;
                container.appendChild(noContact);
            }
        }

        function setupCorporatorContacts(result) {
            const contactsContainer = document.getElementById('corporatorContacts');
            contactsContainer.innerHTML = '';
            
            console.log("All available fields in result:", Object.keys(result));
            
            // Look specifically for CORPORATOR contact fields
            const corporatorContactFields = Object.keys(result).filter(key => 
                (key.includes('contact1') || key.includes('contact2')) && 
                !key.includes('mla')
            );
            
            console.log("Corporator contact fields:", corporatorContactFields);
            
            let contactCount = 0;
            
            // Try corporator-specific fields
            for (const field of corporatorContactFields) {
                if (result[field] && result[field].trim() !== "" && result[field] !== "N/A") {
                    createContactLink(result[field], contactsContainer, `Corporator (${field})`);
                    contactCount++;
                }
            }
            
            // If still no contacts found, show N/A
            if (contactCount === 0) {
                const noContact = document.createElement('div');
                noContact.className = 'contact-link';
                noContact.innerHTML = `<i class="fab fa-whatsapp"></i> <span>N/A</span>`;
                contactsContainer.appendChild(noContact);
                console.log("No corporator contact numbers found in any field");
            }
        }

        function createContactLink(contact, container, fieldName = '') {
            const contactLink = document.createElement('a');
            contactLink.href = `https://wa.me/${formatContactNumber(contact)}`;
            contactLink.className = 'contact-link';
            contactLink.target = '_blank';
            contactLink.innerHTML = `<i class="fab fa-whatsapp"></i> <span>${contact}</span>`;
            contactLink.onclick = function() { 
                return trackContactClick('Corporator'); 
            };
            
            if (fieldName) {
                console.log(`Creating contact link from ${fieldName}: ${contact}`);
            }
            container.appendChild(contactLink);
        }

        function formatContactNumber(contact) {
            if (!contact) return '';
            
            // Clean the contact number
            let cleanContact = contact.toString().replace(/\D/g, '');
            
            // Ensure it's in international format for WhatsApp
            if (cleanContact.startsWith('91') && cleanContact.length === 12) {
                // Already in correct format
            } else if (cleanContact.length === 10) {
                cleanContact = '91' + cleanContact;
            }
            
            return cleanContact;
        }

        // Show search suggestions
        function showSuggestions() {
            if (!dataLoaded) return;
            
            const input = document.getElementById('ward').value.toLowerCase();
            if (input.length < 1) {
                document.getElementById('suggestions').style.display = 'none';
                return;
            }
            
            const suggestions = csvData.filter(row => {
                const wardNo = (row["wardno"] || "").toString().toLowerCase();
                return wardNo.includes(input);
            }).slice(0, 5);

            const suggestionsContainer = document.getElementById('suggestions');
            suggestionsContainer.innerHTML = '';
            
            if (suggestions.length > 0) {
                suggestions.forEach(row => {
                    const wardNo = row["wardno"] || "N/A";
                    
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = `Ward ${wardNo}`;
                    div.onclick = function() {
                        document.getElementById('ward').value = wardNo;
                        suggestionsContainer.style.display = 'none';
                        fetchWardData();
                    };
                    suggestionsContainer.appendChild(div);
                });
                suggestionsContainer.style.display = 'block';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        // Improved Error Handling
        function showError(message, isUserFriendly = true) {
            const errorElement = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            
            if (isUserFriendly) {
                errorText.innerText = message;
            } else {
                errorText.innerText = "Unable to load data. Please check your connection and try again.";
                console.error("Technical error:", message);
            }
            
            errorElement.style.display = 'block';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
        }

        function scrollToSection(sectionId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[data-tab="${sectionId}"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
        }

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Event listeners
        document.getElementById('ward').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fetchWardData();
            }
        });

        document.getElementById('ward').addEventListener('input', showSuggestions);

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                document.getElementById('suggestions').style.display = 'none';
            }
        });

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if terms were previously accepted
            termsAccepted = localStorage.getItem('knowYourAreaTermsAccepted') === 'true';
            
            loadAnalytics();
            trackVisitor();
            loadDataWithCache(); // Use cached version instead
            
            // Show terms modal if not accepted
            if (!termsAccepted) {
                setTimeout(() => {
                    showTermsModal();
                }, 1000);
            }
        });
    </script>
</body>
</html>
